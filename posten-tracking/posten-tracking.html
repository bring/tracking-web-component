<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../posten-tracking-search/posten-tracking-search.html">
<link rel="import" href="../html-echo.html">

<polymer-element name="posten-tracking" attributes="trackingNumber language" layout vertical>
  <template>
    <link rel="stylesheet" href="posten-tracking.css">

    <posten-tracking-search trackingNumber="{{trackingNumber}}" package="{{package}}" error="{{error}}" language="{{language}}"></posten-tracking-search>

    <div layout horizontal>
      <div class="package" hidden?={{!package}}></div>
      <div>
        <h1 class="small">{{package.packageNumber}}</h1>
        <div id="status">
          <div class="error" hidden?="{{!error}}">
              <p>{{language | i18n(error.code)}} <strong>{{trackingNumber}}</strong></p>
          </div>
        </div>
        <paper-button hidden?={{!package}} label="Vis alle" on-tap="{{showAllEvents}}"></paper-button>
        <ul id="events" class="{{ {expanded: expanded} | tokenList}}">
          <template repeat="{{event in package.eventSet}}">
            <li>{{event.displayTime}} {{event.displayDate}} <html-echo html="{{event.description}}"></html-echo></li>
          </template>
        </ul>
      </div>
    </div>
  </template>
  <script>
    Polymer("posten-tracking", {
        showAllEvents: function (ev, detail, sender) {
            this.expanded = true;
        },
        ready: function() {
            this.language = this.isLegalLanguage() ? this.language : 'no';
        },
        i18n: function(language, key) {
            if(this.texts[key] && this.texts[key][language]) {
                return this.texts[key][language];
            }
            return '';
        },
        isLegalLanguage: function() {
            var legalLanguages = ['no', 'en', 'da', 'sv'];
            return _.contains(legalLanguages, this.language);
        },
        texts: {
            '404': {
                no: 'Ingen sending funnet for',
                en: 'No shipments found for',
                da: 'Der blev ikke fundet nogen forsendelse for',
                sv: 'Ingen sändning hittades för'
            },
            '500': {
                no: 'Feil ved henting av sporingsinformasjon',
                en: 'Error getting track & trace information',
                da: 'Der opstod en fejl ved hentning af sporingsinformation',
                sv: 'Fel vid hämtning av tracking-information'
            }
        }
    });
  </script>
</polymer-element>
